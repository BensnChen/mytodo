<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>å¾…åŠæ¸…å•</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  
  <style>
    [v-cloak] { display: none; }
    
    body {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }
    
    .todo-item {
      transition: all 0.3s ease;
    }
    
    @media (hover: hover) {
      .todo-item:hover {
        transform: translateY(-2px);
      }
    }
    
    .completed {
      opacity: 0.6;
    }
    
    .completed .todo-title {
      text-decoration: line-through;
    }
    
    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    @media (max-width: 640px) {
      .stat-card {
        padding: 0.75rem;
      }
      
      .stat-value {
        font-size: 1.5rem;
      }
      
      .stat-label {
        font-size: 0.75rem;
      }
    }
    
    /* é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾ */
    button, a {
      touch-action: manipulation;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div id="app" v-cloak class="container mx-auto px-3 sm:px-4 py-4 sm:py-8 max-w-4xl pb-safe">
    
    <!-- å¤´éƒ¨ -->
    <div class="text-center mb-6 sm:mb-12">
      <h1 class="text-3xl sm:text-5xl font-bold text-gray-800 mb-2">ğŸ“ å¾…åŠæ¸…å•</h1>
      <p class="text-sm sm:text-base text-gray-600">ç®€å•é«˜æ•ˆçš„ä»»åŠ¡ç®¡ç†</p>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-8">
      <div class="stat-card bg-white rounded-xl sm:rounded-2xl p-3 sm:p-4 shadow-sm text-center">
        <div class="stat-value text-2xl sm:text-3xl font-bold text-gray-800">{{ stats.total }}</div>
        <div class="stat-label text-xs sm:text-sm text-gray-500 mt-1">å…¨éƒ¨</div>
      </div>
      <div class="stat-card bg-yellow-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 shadow-sm text-center">
        <div class="stat-value text-2xl sm:text-3xl font-bold text-yellow-600">{{ stats.pending }}</div>
        <div class="stat-label text-xs sm:text-sm text-gray-600 mt-1">å¾…å¤„ç†</div>
      </div>
      <div class="stat-card bg-blue-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 shadow-sm text-center">
        <div class="stat-value text-2xl sm:text-3xl font-bold text-blue-600">{{ stats.inProgress }}</div>
        <div class="stat-label text-xs sm:text-sm text-gray-600 mt-1">è¿›è¡Œä¸­</div>
      </div>
      <div class="stat-card bg-green-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 shadow-sm text-center">
        <div class="stat-value text-2xl sm:text-3xl font-bold text-green-600">{{ stats.completed }}</div>
        <div class="stat-label text-xs sm:text-sm text-gray-600 mt-1">å·²å®Œæˆ</div>
      </div>
    </div>

    <!-- æ–°å¢å¾…åŠ -->
    <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-8">
      <div class="flex gap-2 sm:gap-3">
        <input 
          v-model="newTodo.title"
          @keyup.enter="quickAddTodo"
          type="text" 
          placeholder="æ·»åŠ æ–°ä»»åŠ¡..."
          class="flex-1 px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        
        <button 
          @click="showDetailForm = !showDetailForm"
          class="px-3 sm:px-4 py-2 sm:py-3 text-lg sm:text-xl bg-gray-100 active:bg-gray-200 rounded-lg sm:rounded-xl transition-colors flex-shrink-0"
          title="è¯¦ç»†è®¾ç½®">
          âš™ï¸
        </button>
        
        <button 
          @click="quickAddTodo"
          class="px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base bg-blue-600 active:bg-blue-700 text-white rounded-lg sm:rounded-xl font-medium transition-colors flex-shrink-0">
          æ·»åŠ 
        </button>
      </div>

      <!-- è¯¦ç»†è¡¨å• -->
      <div v-if="showDetailForm" class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-100 grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3">
        <select v-model="newTodo.priority" class="px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
          <option value="medium">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
          <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
        </select>
        
        <input 
          v-model="newTodo.category"
          type="text" 
          placeholder="åˆ†ç±»ï¼ˆå¦‚ï¼šå·¥ä½œã€å­¦ä¹ ï¼‰"
          class="px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        
        <input 
          v-model="newTodo.dueDate"
          type="date"
          class="px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
    </div>

    <!-- ç­›é€‰æ ‡ç­¾ -->
    <div class="flex flex-wrap gap-2 mb-4 sm:mb-6">
      <button 
        @click="filterStatus = ''"
        :class="['px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-colors',
                 filterStatus === '' ? 'bg-gray-800 text-white' : 'bg-white text-gray-600 active:bg-gray-100']">
        å…¨éƒ¨
      </button>
      <button 
        @click="filterStatus = 'pending'"
        :class="['px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-colors',
                 filterStatus === 'pending' ? 'bg-yellow-500 text-white' : 'bg-white text-gray-600 active:bg-gray-100']">
        å¾…å¤„ç†
      </button>
      <button 
        @click="filterStatus = 'in-progress'"
        :class="['px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-colors',
                 filterStatus === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-white text-gray-600 active:bg-gray-100']">
        è¿›è¡Œä¸­
      </button>
      <button 
        @click="filterStatus = 'completed'"
        :class="['px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-colors',
                 filterStatus === 'completed' ? 'bg-green-500 text-white' : 'bg-white text-gray-600 active:bg-gray-100']">
        å·²å®Œæˆ
      </button>
    </div>

    <!-- å¾…åŠåˆ—è¡¨ -->
    <div class="space-y-2 sm:space-y-3">
      <div 
        v-for="todo in filteredTodos" 
        :key="todo.id"
        :class="['todo-item bg-white rounded-xl sm:rounded-2xl shadow-sm p-4 sm:p-5', todo.status === 'completed' && 'completed']">
        
        <div class="flex items-start gap-3 sm:gap-4">
          <!-- çŠ¶æ€åˆ‡æ¢ -->
          <button 
            @click="toggleStatus(todo)"
            :class="['flex-shrink-0 w-5 h-5 sm:w-6 sm:h-6 rounded-full border-2 transition-all mt-0.5 sm:mt-1 flex items-center justify-center',
                     todo.status === 'completed' 
                       ? 'bg-green-500 border-green-500' 
                       : todo.status === 'in-progress'
                       ? 'bg-blue-500 border-blue-500'
                       : 'border-gray-300 active:border-blue-500']">
            <span v-if="todo.status === 'completed'" class="text-white text-xs">âœ“</span>
            <span v-else-if="todo.status === 'in-progress'" class="text-white text-xs leading-none">â€¢</span>
          </button>

          <!-- å†…å®¹ -->
          <div class="flex-1 min-w-0">
            <div class="flex items-start justify-between gap-2 sm:gap-3">
              <div class="flex-1 min-w-0">
                <h3 class="todo-title text-base sm:text-lg font-medium text-gray-800 mb-1 break-words">
                  {{ todo.title }}
                </h3>
                <p v-if="todo.description" class="text-xs sm:text-sm text-gray-500 mb-2 break-words">
                  {{ todo.description }}
                </p>
                
                <div class="flex flex-wrap gap-1.5 sm:gap-2 text-xs">
                  <span v-if="todo.priority" :class="getPriorityBadgeClass(todo.priority)">
                    {{ getPriorityIcon(todo.priority) }} {{ getPriorityText(todo.priority) }}
                  </span>
                  <span v-if="todo.category" class="px-2 py-0.5 sm:py-1 bg-purple-100 text-purple-700 rounded-full whitespace-nowrap">
                    ğŸ·ï¸ {{ todo.category }}
                  </span>
                  <span v-if="todo.due_date" class="px-2 py-0.5 sm:py-1 bg-gray-100 text-gray-600 rounded-full whitespace-nowrap">
                    ğŸ“… {{ todo.due_date }}
                  </span>
                </div>
              </div>

              <!-- æ“ä½œæŒ‰é’® -->
              <div class="flex gap-1 sm:gap-2 flex-shrink-0">
                <button 
                  @click="editTodo(todo)"
                  class="text-gray-400 active:text-blue-600 transition-colors p-1 text-lg sm:text-xl"
                  title="ç¼–è¾‘">
                  âœï¸
                </button>
                <button 
                  @click="deleteTodo(todo.id)"
                  class="text-gray-400 active:text-red-600 transition-colors p-1 text-lg sm:text-xl"
                  title="åˆ é™¤">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      <div v-if="filteredTodos.length === 0" class="text-center py-12 sm:py-16">
        <div class="text-5xl sm:text-6xl mb-4">ğŸ“­</div>
        <p class="text-gray-500 text-base sm:text-lg">æš‚æ— å¾…åŠäº‹é¡¹</p>
        <p class="text-gray-400 text-xs sm:text-sm mt-2">æ·»åŠ ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼</p>
      </div>
    </div>

    <!-- ç¼–è¾‘å¯¹è¯æ¡† -->
    <div v-if="editingTodo" class="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50" @click.self="editingTodo = null">
      <div class="bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl w-full sm:max-w-lg sm:w-full p-6 sm:p-8 max-h-[90vh] overflow-y-auto">
        <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">ç¼–è¾‘ä»»åŠ¡</h2>
        
        <div class="space-y-3 sm:space-y-4">
          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">æ ‡é¢˜</label>
            <input 
              v-model="editForm.title"
              type="text"
              class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">æè¿°</label>
            <textarea 
              v-model="editForm.description"
              rows="3"
              class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
          </div>

          <div class="grid grid-cols-2 gap-2 sm:gap-4">
            <div>
              <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">çŠ¶æ€</label>
              <select v-model="editForm.status" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="pending">å¾…å¤„ç†</option>
                <option value="in-progress">è¿›è¡Œä¸­</option>
                <option value="completed">å·²å®Œæˆ</option>
              </select>
            </div>

            <div>
              <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">ä¼˜å…ˆçº§</label>
              <select v-model="editForm.priority" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="low">ä½</option>
                <option value="medium">ä¸­</option>
                <option value="high">é«˜</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4">
            <div>
              <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">åˆ†ç±»</label>
              <input 
                v-model="editForm.category"
                type="text"
                class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
              <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2">æˆªæ­¢æ—¥æœŸ</label>
              <input 
                v-model="editForm.dueDate"
                type="date"
                class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
          </div>
        </div>

        <div class="flex gap-2 sm:gap-3 mt-6 sm:mt-8">
          <button 
            @click="editingTodo = null"
            class="flex-1 px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base bg-gray-100 active:bg-gray-200 text-gray-700 rounded-lg sm:rounded-xl font-medium transition-colors">
            å–æ¶ˆ
          </button>
          <button 
            @click="saveEdit"
            class="flex-1 px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base bg-blue-600 active:bg-blue-700 text-white rounded-lg sm:rounded-xl font-medium transition-colors">
            ä¿å­˜
          </button>
        </div>
      </div>
    </div>

    <!-- é¡µè„š -->
    <div class="text-center mt-8 sm:mt-12 text-gray-500 text-xs sm:text-sm pb-4">
      <p>Â© 2026 å¾…åŠæ¸…å• Â· ç®€å•é«˜æ•ˆ</p>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed, onMounted } = Vue;

    // API é…ç½®
    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:3000/api'
      : 'https://your-backend-api.vercel.app/api';

    createApp({
      setup() {
        const todos = ref([]);
        const filterStatus = ref('');
        const showDetailForm = ref(false);
        const editingTodo = ref(null);
        
        const newTodo = reactive({
          title: '',
          description: '',
          priority: 'medium',
          category: '',
          dueDate: ''
        });

        const editForm = reactive({
          title: '',
          description: '',
          status: 'pending',
          priority: 'medium',
          category: '',
          dueDate: ''
        });

        const stats = computed(() => {
          return {
            total: todos.value.length,
            pending: todos.value.filter(t => t.status === 'pending').length,
            inProgress: todos.value.filter(t => t.status === 'in-progress').length,
            completed: todos.value.filter(t => t.status === 'completed').length
          };
        });

        const filteredTodos = computed(() => {
          if (!filterStatus.value) return todos.value;
          return todos.value.filter(t => t.status === filterStatus.value);
        });

        const loadTodos = async () => {
          try {
            const response = await fetch(`${API_BASE_URL}/todos`);
            const result = await response.json();
            if (result.success) {
              todos.value = result.data;
            }
          } catch (error) {
            console.error('åŠ è½½å¤±è´¥:', error);
            alert('åŠ è½½å¾…åŠäº‹é¡¹å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
          }
        };

        const quickAddTodo = async () => {
          if (!newTodo.title.trim()) {
            alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
            return;
          }

          try {
            const response = await fetch(`${API_BASE_URL}/todos`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                title: newTodo.title,
                description: newTodo.description,
                priority: newTodo.priority,
                category: newTodo.category,
                dueDate: newTodo.dueDate,
                status: 'pending'
              })
            });

            const result = await response.json();
            if (result.success) {
              await loadTodos();
              newTodo.title = '';
              newTodo.description = '';
              newTodo.category = '';
              newTodo.dueDate = '';
              newTodo.priority = 'medium';
              showDetailForm.value = false;
            }
          } catch (error) {
            console.error('æ·»åŠ å¤±è´¥:', error);
            alert('æ·»åŠ å¤±è´¥ï¼Œè¯·é‡è¯•');
          }
        };

        const toggleStatus = async (todo) => {
          const statusMap = {
            'pending': 'in-progress',
            'in-progress': 'completed',
            'completed': 'pending'
          };

          try {
            const response = await fetch(`${API_BASE_URL}/todos/${todo.id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                ...todo,
                status: statusMap[todo.status]
              })
            });

            if (response.ok) {
              await loadTodos();
            }
          } catch (error) {
            console.error('æ›´æ–°å¤±è´¥:', error);
          }
        };

        const editTodo = (todo) => {
          editingTodo.value = todo;
          editForm.title = todo.title;
          editForm.description = todo.description || '';
          editForm.status = todo.status;
          editForm.priority = todo.priority;
          editForm.category = todo.category || '';
          editForm.dueDate = todo.due_date || '';
        };

        const saveEdit = async () => {
          if (!editForm.title.trim()) {
            alert('è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜');
            return;
          }

          try {
            const response = await fetch(`${API_BASE_URL}/todos/${editingTodo.value.id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                title: editForm.title,
                description: editForm.description,
                status: editForm.status,
                priority: editForm.priority,
                category: editForm.category,
                dueDate: editForm.dueDate
              })
            });

            if (response.ok) {
              await loadTodos();
              editingTodo.value = null;
            }
          } catch (error) {
            console.error('ä¿å­˜å¤±è´¥:', error);
            alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
          }
        };

        const deleteTodo = async (id) => {
          if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;

          try {
            const response = await fetch(`${API_BASE_URL}/todos/${id}`, {
              method: 'DELETE'
            });

            if (response.ok) {
              await loadTodos();
            }
          } catch (error) {
            console.error('åˆ é™¤å¤±è´¥:', error);
            alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
          }
        };

        const getPriorityIcon = (priority) => {
          const map = { 'high': 'ğŸ”´', 'medium': 'ğŸŸ¡', 'low': 'ğŸŸ¢' };
          return map[priority] || 'âšª';
        };

        const getPriorityText = (priority) => {
          const map = { 'high': 'é«˜', 'medium': 'ä¸­', 'low': 'ä½' };
          return map[priority] || priority;
        };

        const getPriorityBadgeClass = (priority) => {
          const map = {
            'high': 'px-2 py-0.5 sm:py-1 bg-red-100 text-red-700 rounded-full whitespace-nowrap',
            'medium': 'px-2 py-0.5 sm:py-1 bg-yellow-100 text-yellow-700 rounded-full whitespace-nowrap',
            'low': 'px-2 py-0.5 sm:py-1 bg-green-100 text-green-700 rounded-full whitespace-nowrap'
          };
          return map[priority] || 'px-2 py-0.5 sm:py-1 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap';
        };

        onMounted(() => {
          loadTodos();
        });

        return {
          todos,
          filterStatus,
          showDetailForm,
          editingTodo,
          newTodo,
          editForm,
          stats,
          filteredTodos,
          quickAddTodo,
          toggleStatus,
          editTodo,
          saveEdit,
          deleteTodo,
          getPriorityIcon,
          getPriorityText,
          getPriorityBadgeClass
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
